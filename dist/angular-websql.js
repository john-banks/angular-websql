"use strict";angular.module("angular-websql",[]).factory("$webSql",["$q",function(e){return{openDatabase:function(t,r,n,a){try{var u=openDatabase(t,r,n,a);if("undefined"==typeof openDatabase)throw"Browser does not support web sql";return{executeQuery:function(t,r){var n=e.defer();return u.transaction(function(e){try{e.executeSql(t,r,function(e,t){n.resolve(t)},function(e,r){console.error(t),console.error(r),n.reject(r)})}catch(a){console.log(a)}},function(e){console.log("transaction error"),n.reject(e)}),n.promise},insert:function(e,t){var r="INSERT INTO `{tableName}` ({fields}) VALUES({values});",n="",a="",u=[];for(var o in t)n+=Object.keys(t)[Object.keys(t).length-1]==o?"`"+o+"`":"`"+o+"`, ",a+=Object.keys(t)[Object.keys(t).length-1]==o?"?":"?, ",u.push(t[o]);return this.executeQuery(this.replace(r,{"{tableName}":e,"{fields}":n,"{values}":a}),u)},update:function(e,t,r){var n="UPDATE `{tableName}` SET {update} WHERE {where}; ",a="",u=[],o=!0;for(var i in t)o?o=!1:a+=",",a+="`"+i+"`= ?",u.push(t[i]);var l=this.whereClause(r);return this.executeQuery(this.replace(n,{"{tableName}":e,"{update}":a,"{where}":l.w}),u.concat(l.p))},del:function(e,t){var r="DELETE FROM `{tableName}` WHERE {where}; ",n=this.whereClause(t);return this.executeQuery(this.replace(r,{"{tableName}":e,"{where}":n.w}),n.p)},select:function(e,t){var r="SELECT * FROM `{tableName}` WHERE {where}; ",n=this.whereClause(t);return this.executeQuery(this.replace(r,{"{tableName}":e,"{where}":n.w}),n.p)},selectAll:function(e){return this.executeQuery("SELECT * FROM `"+e+"`; ",[])},whereClause:function(e){var t="",r=[];for(var n in e)e[n].value&&(e[n].value=String(e[n].value)),"undefined"==typeof e[n]||"object"==typeof e[n]||"string"!=typeof e[n]||e[n].match(/NULL/gi)?"undefined"!=typeof e[n]&&"object"!=typeof e[n]&&"number"==typeof e[n]?r.push(e[n]):"undefined"==typeof e[n].value||"object"!=typeof e[n]||e[n].value.match(/NULL/gi)||r.push(e[n].value):r.push(e[n]),t+="object"==typeof e[n]?"undefined"==typeof e[n].union?"string"==typeof e[n].value&&e[n].value.match(/NULL/gi)?"`"+n+"` "+e[n].value:"`"+n+"` "+e[n].operator+" ? ":"string"==typeof e[n].value&&e[n].value.match(/NULL/gi)?"`"+n+"` "+e[n].value+" "+e[n].union+" ":"`"+n+"` "+e[n].operator+" ? "+e[n].union+" ":"string"==typeof e[n]&&e[n].match(/NULL/gi)?"`"+n+"` "+e[n]:"`"+n+"`=?";return{w:t,p:r}},replace:function(e,t){for(var r in t)e=e.replace(new RegExp(r,"ig"),t[r]);return e},createTable:function(e,t){var r="CREATE TABLE IF NOT EXISTS `{tableName}` ({fields}); ",n=[],a="";for(var u in t){var o="{type} {null}";a+="`"+u+"` ","undefined"==typeof t[u]["null"]&&(t[u]["null"]="NULL");for(var i in t[u])o=o.replace(new RegExp("{"+i+"}","ig"),t[u][i]);a+=o,"undefined"!=typeof t[u]["default"]&&(a+=" DEFAULT "+t[u]["default"]),"undefined"!=typeof t[u].primary&&(a+=" PRIMARY KEY"),"undefined"!=typeof t[u].auto_increment&&(a+=" AUTOINCREMENT"),Object.keys(t)[Object.keys(t).length-1]!=u&&(a+=","),"undefined"!=typeof t[u].primary&&t[u].primary&&n.push(u)}var l={tableName:e,fields:a};for(var c in l)r=r.replace(new RegExp("{"+c+"}","ig"),l[c]);return this.executeQuery(r,[])},dropTable:function(e){return this.executeQuery("DROP TABLE IF EXISTS `"+e+"`; ",[])}}}catch(o){console.error(o)}}}}]);